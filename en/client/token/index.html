<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" type=image/png href=/favicon.ico><link rel=stylesheet href=https://docs.monado.ren/style.min.ac66b095598a93816a47e5ef5b071058047fa4bd8770cb4515ca10c1ad6f91c0.css><script src=https://docs.monado.ren/main.min.db37c27117ff8400e5e30549f6806d2bc825668b596d81316c6148417f59bc72.js async></script><title>Obtaining client app access - Mastodon文档 -Monado-</title><meta property="og:type" content="article"><meta property="og:url" content="https://docs.monado.ren/en/client/token/"><meta name=description content="Getting accustomed to the basics of authentication and authorization."><meta property="og:description" content="Getting accustomed to the basics of authentication and authorization."><meta name=twitter:description content="Getting accustomed to the basics of authentication and authorization."><meta name=twitter:title content="Obtaining client app access"><meta name=twitter:site content="@joinmastodon"><link rel=canonical href=https://docs.monado.ren/en/client/token/></head><body><div class="container sidebar-layout"><nav class=sidebar><a class=brand href=/><img class=link-logo src=/brand.svg alt=Mastodon></a><ul><li><a href=/en/>What is Mastodon?</a></li><li><span class=sub-title>Using Mastodon</span><ul class=sub-menu><li><a href=/en/user/signup/>Signing up for an account</a></li><li><a href=/en/user/profile/>Setting up your profile</a></li><li><a href=/en/user/posting/>Posting toots</a></li><li><a href=/en/user/network/>Using the network features</a></li><li><a href=/en/user/moderating/>Dealing with unwanted content</a></li><li><a href=/en/user/discoverability/>Promoting yourself and others</a></li><li><a href=/en/user/preferences/>Set your preferences</a></li><li><a href=/en/user/contacts/>More settings</a></li><li><a href=/en/user/external/>Using Mastodon externally</a></li><li><a href=/en/user/moving/>Moving or leaving accounts</a></li><li><a href=/en/user/run-your-own/>Running your own server</a></li></ul></li><li><span class=sub-title>Running Mastodon</span><ul class=sub-menu><li><a href=/en/admin/prerequisites/>Preparing your machine</a></li><li><a href=/en/admin/install/>Installing from source</a></li><li><a href=/en/admin/config/>Configuring your environment</a></li><li><a href=/en/admin/optional/>Installing optional features</a><ul class=sub-menu><li><a href=/en/admin/optional/elasticsearch/>Full-text search</a></li><li><a href=/en/admin/optional/tor/>Hidden services</a></li><li><a href=/en/admin/optional/sso/>Single Sign On</a></li></ul></li><li><a href=/en/admin/setup/>Setting up your new instance</a></li><li><a href=/en/admin/tootctl/>Using the admin CLI</a></li><li><a href=/en/admin/upgrading/>Upgrading to a new release</a></li><li><a href=/en/admin/backups/>Backing up your server</a></li><li><a href=/en/admin/migrating/>Migrating to a new machine</a></li><li><a href=/en/admin/scaling/>Scaling up your server</a></li><li><a href=/en/admin/moderation/>Moderation actions</a></li><li><a href=/en/admin/troubleshooting/>Troubleshooting errors</a><ul class=sub-menu><li><a href=/en/admin/troubleshooting/index-corruption/>Database index corruption</a></li></ul></li></ul></li><li><span class=sub-title>Developing Mastodon apps</span><ul class=sub-menu><li><a href=/en/client/intro/>Getting started with the API</a></li><li><a href=/en/client/public/>Playing with public data</a></li><li><a href=/en/client/token/ class=active>Obtaining client app access</a></li><li><a href=/en/client/authorized/>Logging in with an account</a></li><li><a href=/en/client/guidelines/>Guidelines and best practices</a></li><li><a href=/en/client/libraries/>Libraries and implementations</a></li></ul></li><li><span class=sub-title>Contributing to Mastodon</span><ul class=sub-menu><li><a href=/en/dev/overview/>Technical overview</a></li><li><a href=/en/dev/setup/>Setting up a dev environment</a></li><li><a href=/en/dev/code/>Code structure</a></li><li><a href=/en/dev/routes/>Routes</a></li><li><a href=/en/dev/disclosure/>Bug bounties and responsible disclosure</a></li></ul></li><li><span class=sub-title>Spec compliance</span><ul class=sub-menu><li><a href=/en/spec/activitypub/>ActivityPub</a></li><li><a href=/en/spec/webfinger/>WebFinger</a></li><li><a href=/en/spec/security/>Security</a></li><li><a href=/en/spec/microformats/>Microformats</a></li><li><a href=/en/spec/oauth/>OAuth</a></li><li><a href=/en/spec/bearcaps/>Bearcaps</a></li></ul></li><li><span class=sub-title>REST API</span><ul class=sub-menu><li><a href=/en/api/oauth-scopes/>OAuth Scopes</a></li><li><a href=/en/api/rate-limits/>Rate limits</a></li></ul></li><li><span class=sub-title>API Methods</span><ul class=sub-menu><li><a href=/en/methods/apps/>apps</a><ul class=sub-menu><li><a href=/en/methods/apps/oauth/>oauth</a></li></ul></li><li><a href=/en/methods/accounts/>accounts</a><ul class=sub-menu><li><a href=/en/methods/accounts/bookmarks/>bookmarks</a></li><li><a href=/en/methods/accounts/favourites/>favourites</a></li><li><a href=/en/methods/accounts/mutes/>mutes</a></li><li><a href=/en/methods/accounts/blocks/>blocks</a></li><li><a href=/en/methods/accounts/domain_blocks/>domain_blocks</a></li><li><a href=/en/methods/accounts/filters/>filters</a></li><li><a href=/en/methods/accounts/reports/>reports</a></li><li><a href=/en/methods/accounts/follow_requests/>follow_requests</a></li><li><a href=/en/methods/accounts/endorsements/>endorsements</a></li><li><a href=/en/methods/accounts/featured_tags/>featured_tags</a></li><li><a href=/en/methods/accounts/preferences/>preferences</a></li><li><a href=/en/methods/accounts/suggestions/>suggestions</a></li></ul></li><li><a href=/en/methods/statuses/>statuses</a><ul class=sub-menu><li><a href=/en/methods/statuses/media/>media</a></li><li><a href=/en/methods/statuses/polls/>polls</a></li><li><a href=/en/methods/statuses/scheduled_statuses/>scheduled_statuses</a></li></ul></li><li><a href=/en/methods/timelines/>timelines</a><ul class=sub-menu><li><a href=/en/methods/timelines/conversations/>conversations</a></li><li><a href=/en/methods/timelines/lists/>lists</a></li><li><a href=/en/methods/timelines/markers/>markers</a></li><li><a href=/en/methods/timelines/streaming/>streaming</a></li></ul></li><li><a href=/en/methods/notifications/>notifications</a><ul class=sub-menu><li><a href=/en/methods/notifications/push/>push</a></li></ul></li><li><a href=/en/methods/search/>search</a></li><li><a href=/en/methods/instance/>instance</a><ul class=sub-menu><li><a href=/en/methods/instance/trends/>trends</a></li><li><a href=/en/methods/instance/directory/>directory</a></li><li><a href=/en/methods/instance/custom_emojis/>custom_emojis</a></li></ul></li><li><a href=/en/methods/admin/>admin</a></li><li><a href=/en/methods/announcements/>announcements</a></li><li><a href=/en/methods/proofs/>proofs</a></li><li><a href=/en/methods/oembed/>oembed</a></li></ul></li><li><span class=sub-title>API Entities</span><ul class=sub-menu><li><a href=/en/entities/account/>Account</a></li><li><a href=/en/entities/activity/>Activity</a></li><li><a href=/en/entities/admin-account/>Admin::Account</a></li><li><a href=/en/entities/admin-report/>Admin::Report</a></li><li><a href=/en/entities/announcement/>Announcement</a></li><li><a href=/en/entities/announcementreaction/>AnnouncementReaction</a></li><li><a href=/en/entities/application/>Application</a></li><li><a href=/en/entities/attachment/>Attachment</a></li><li><a href=/en/entities/card/>Card</a></li><li><a href=/en/entities/context/>Context</a></li><li><a href=/en/entities/conversation/>Conversation</a></li><li><a href=/en/entities/emoji/>Emoji</a></li><li><a href=/en/entities/error/>Error</a></li><li><a href=/en/entities/featuredtag/>FeaturedTag</a></li><li><a href=/en/entities/field/>Field</a></li><li><a href=/en/entities/filter/>Filter</a></li><li><a href=/en/entities/history/>History</a></li><li><a href=/en/entities/identityproof/>IdentityProof</a></li><li><a href=/en/entities/instance/>Instance</a></li><li><a href=/en/entities/list/>List</a></li><li><a href=/en/entities/marker/>Marker</a></li><li><a href=/en/entities/mention/>Mention</a></li><li><a href=/en/entities/notification/>Notification</a></li><li><a href=/en/entities/poll/>Poll</a></li><li><a href=/en/entities/preferences/>Preferences</a></li><li><a href=/en/entities/pushsubscription/>PushSubscription</a></li><li><a href=/en/entities/relationship/>Relationship</a></li><li><a href=/en/entities/report/>Report</a></li><li><a href=/en/entities/results/>Results</a></li><li><a href=/en/entities/scheduledstatus/>ScheduledStatus</a></li><li><a href=/en/entities/source/>Source</a></li><li><a href=/en/entities/status/>Status</a></li><li><a href=/en/entities/tag/>Tag</a></li><li><a href=/en/entities/token/>Token</a></li></ul></li></ul></nav><main><h1>Obtaining client app access</h1><p>Getting accustomed to the basics of authentication and authorization.</p><aside><nav id=TableOfContents><ul><li><ul><li><a href=#auth>Authentication and authorization</a></li><li><a href=#app>Creating our application</a></li><li><a href=#flow>Example authentication code flow</a></li><li><a href=#methods>What we can do with authentication</a></li></ul></li></ul></nav></aside><div class=e-content><h2 id=auth>Authentication and authorization</h2><p>Up until this point, we've been working with publicly available information, but not all information is public. Some information requires permission before viewing it, in order to audit who is requesting that information (and to potentially revoke or deny access).</p><p>This is where <a href=/en/spec/oauth/>OAuth</a> comes in. OAuth is a mechanism for generating access tokens which can be used to <em>authenticate (verify)</em> that a request is coming from a specific client, and ensure that the requested action is <em>authorized (allowed)</em> by the server's access control policies.</p><h2 id=app>Creating our application</h2><p>The first thing we will need to do is to register an application, in order to be able to generate access tokens later. The application can be created like so:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>curl -X POST <span style=color:#f1fa8c>\
</span><span style=color:#f1fa8c></span>	-F <span style=color:#f1fa8c>&#39;client_name=Test Application&#39;</span> <span style=color:#f1fa8c>\
</span><span style=color:#f1fa8c></span>	-F <span style=color:#f1fa8c>&#39;redirect_uris=urn:ietf:wg:oauth:2.0:oob&#39;</span> <span style=color:#f1fa8c>\
</span><span style=color:#f1fa8c></span>	-F <span style=color:#f1fa8c>&#39;scopes=read write follow push&#39;</span> <span style=color:#f1fa8c>\
</span><span style=color:#f1fa8c></span>	-F <span style=color:#f1fa8c>&#39;website=https://myapp.example&#39;</span> <span style=color:#f1fa8c>\
</span><span style=color:#f1fa8c></span>	https://mastodon.example/api/v1/apps
</code></pre></div><p>In the above example, we specify the client name and website, which will be shown on statuses if applicable. But more importantly, note the following two parameters:</p><ul><li><code>redirect_uris</code> has been set to the &ldquo;out of band&rdquo; token generation, which means that any generated tokens will have to be copied and pasted manually. The parameter is called <code>redirect_uris</code> because it is possible to define more than one redirect URI, but when generating the token, we will need to provide a URI that is included within this list.</li><li><code>scopes</code> allow us to define what permissions we can request later. However, the requested scope later can be a subset of these registered scopes. See <a href=/en/api/oauth-scopes/>OAuth Scopes</a> for more information.</li></ul><p>We should see an Application entity returned, but for now we only care about client_id and client_secret. These values will be used to generate access tokens, so they should be cached for later use. See <a href=/en/methods/apps/#create-an-application>POST /api/v1/apps</a> for more details on registering applications.</p><h2 id=flow>Example authentication code flow</h2><p>Now that we have an application, let's obtain an access token that will authenticate our requests as that client application. To do so, use <a href=/en/methods/apps/oauth/#obtain-a-token>POST /oauth/token</a> like so:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>curl -X POST <span style=color:#f1fa8c>\
</span><span style=color:#f1fa8c></span>	-F <span style=color:#f1fa8c>&#39;client_id=your_client_id_here&#39;</span> <span style=color:#f1fa8c>\
</span><span style=color:#f1fa8c></span>	-F <span style=color:#f1fa8c>&#39;client_secret=your_client_secret_here&#39;</span> <span style=color:#f1fa8c>\
</span><span style=color:#f1fa8c></span>	-F <span style=color:#f1fa8c>&#39;redirect_uri=urn:ietf:wg:oauth:2.0:oob&#39;</span> <span style=color:#f1fa8c>\
</span><span style=color:#f1fa8c></span>	-F <span style=color:#f1fa8c>&#39;grant_type=client_credentials&#39;</span> <span style=color:#f1fa8c>\
</span><span style=color:#f1fa8c></span>	https://mastodon.example/oauth/token
</code></pre></div><p>Note the following:</p><ul><li><code>client_id</code> and <code>client_secret</code> were provided in the response text when you registered your application.</li><li><code>redirect_uri</code> must be one of the URIs defined when registering the application.</li><li>We are requesting a <code>grant_type</code> of <code>client_credentials</code>, which defaults to giving us the <code>read</code> scope.</li></ul><p>The response of this method is a <a href=/en/entities/token/>Token</a> entity. We will need the <code>access_token</code> value. Once you have the access token, save it in your local cache. To use it in requests, add the HTTP header <code>Authorization: Bearer ...</code> to any API call that requires OAuth (i.e., one that is not publicly accessible). Let's verify that our obtained credentials are working by calling <a href=/en/methods/apps/#verify-your-app-works>GET /api/v1/apps/verify_credentials</a>:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>curl <span style=color:#f1fa8c>\
</span><span style=color:#f1fa8c></span>	-H <span style=color:#f1fa8c>&#39;Authorization: Bearer our_access_token_here&#39;</span> <span style=color:#f1fa8c>\
</span><span style=color:#f1fa8c></span>	https://mastodon.example/api/v1/apps/verify_credentials
</code></pre></div><p>If we've obtained our token and formatted our request correctly, we should see our details returned to us as an <a href=/en/entities/application/>Application</a> entity.</p><h2 id=methods>What we can do with authentication</h2><p>With our authenticated client application, we can view relations of an account with <a href=/en/methods/accounts/#following>GET /api/v1/accounts/:id/following</a> and <a href=/en/methods/accounts/#followers>GET /api/v1/accounts/:id/followers</a>. Also, some instances may require authentication for methods that would otherwise be public, so if you encountered any authentication errors while playing around with public methods, then those methods should now work.</p><p style=color:#687590>Last updated August 10, 2020 · <a href=https://github.com/chasedream1129/mastodon-docs/tree/master/content/en/client/token.md style=color:#687590>Improve this page</a></p></div></main></div></body></html>