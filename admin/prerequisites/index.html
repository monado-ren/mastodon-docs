<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" type=image/png href=/favicon.ico><link rel=stylesheet href=https://docs.monado.ren/style.min.ac66b095598a93816a47e5ef5b071058047fa4bd8770cb4515ca10c1ad6f91c0.css><script src=https://docs.monado.ren/main.min.db37c27117ff8400e5e30549f6806d2bc825668b596d81316c6148417f59bc72.js async></script><title>准备你的机器 - Mastodon文档 -Monado-</title><meta property="og:type" content="article"><meta property="og:url" content="https://docs.monado.ren/admin/prerequisites/"><meta name=twitter:title content="准备你的机器"><meta name=twitter:site content="@joinmastodon"><link rel=canonical href=https://docs.monado.ren/admin/prerequisites/></head><body><div class="container sidebar-layout"><nav class=sidebar><a class=brand href=/><img class=link-logo src=/brand.svg alt=Mastodon></a><ul><li><a href=/>什么是Mastodon？</a></li><li><span class=sub-title>使用Mastodon</span><ul class=sub-menu><li><a href=/user/signup/>创建一个帐户</a></li><li><a href=/user/profile/>设置个人资料</a></li><li><a href=/user/posting/>发布嘟文</a></li><li><a href=/user/network/>使用社交功能</a></li><li><a href=/user/moderating/>处理不想要的内容</a></li><li><a href=/user/discoverability/>推广自己和他人</a></li><li><a href=/user/preferences/>设置你的首选项</a></li><li><a href=/user/contacts/>更多设置</a></li><li><a href=/user/external/>站外使用Mastodon</a></li><li><a href=/user/pwa/>使用PWA版Mastodon</a></li><li><a href=/user/moving/>迁移或删除帐户</a></li><li><a href=/user/run-your-own/>运行自己的服务器</a></li></ul></li><li><span class=sub-title>运营Mastodon</span><ul class=sub-menu><li><a href=/admin/prerequisites/ class=active>准备你的机器</a></li><li><a href=/admin/install/>从源中安装</a></li><li><a href=/admin/config/>设置你的环境</a></li><li><a href=/admin/optional/>安装可选特色功能</a><ul class=sub-menu><li><a href=/admin/optional/elasticsearch/>全文搜索</a></li><li><a href=/admin/optional/tor/>匿名服务</a></li><li><a href=/admin/optional/sso/>单点登录（SSO）</a></li></ul></li><li><a href=/admin/setup/>配置你的新实例</a></li><li><a href=/admin/tootctl/>使用管理命令行</a></li><li><a href=/admin/upgrading/>升级到新版本</a></li><li><a href=/admin/backups/>备份你的服务器</a></li><li><a href=/admin/migrating/>迁移到新机器</a></li><li><a href=/admin/scaling/>伸缩你的服务器</a></li><li><a href=/admin/moderation/>运营操作</a></li><li><a href=/admin/troubleshooting/>故障分析</a></li></ul></li><li><span class=sub-title>前往英文版查看更多</span><ul class=sub-menu><li><a href=/more/more/>更多</a></li></ul></li></ul></nav><main><h1>准备你的机器</h1><aside><nav id=TableOfContents><ul><li><ul><li><a href=#ssh>禁止密码登录SSH（仅允许密钥登录）</a></li><li><a href=#heading>更新系统</a></li><li><a href=#-fail2ban->安装 fail2ban 以阻止重复登录尝试</a></li><li><a href=#sshhttphttps>安装防火墙并只暴露SSH、HTTP、HTTPS端口</a></li></ul></li></ul></nav></aside><div class=e-content><p>如果你正在设置一台全新的机器，推荐你首要完成安全设置。以下内容假定你运行 <strong>Ubuntu 18.04</strong>：</p><h2 id=ssh>禁止密码登录SSH（仅允许密钥登录）</h2><p>首先，请确保你实际上是通过密钥而不是通过密码登录到服务器的，否则这将使你无法登录。许多托管服务提供商支持上传公钥，并自动为新机器设置基于密钥的root登录。</p><p>编辑 <code>/etc/ssh/sshd_config</code> 并找到 <code>PasswordAuthentication</code>。确保它已被去除注释并被设为 <code>no</code>。如果你做了任何改动，请重启 sshd。</p><h2 id=heading>更新系统</h2><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>apt update <span style=color:#ff79c6>&amp;&amp;</span> apt upgrade -y
</code></pre></div><h2 id=-fail2ban->安装 fail2ban 以阻止重复登录尝试</h2><p>编辑 <code>/etc/fail2ban/jail.local</code> 并添加以下内容：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>[DEFAULT]
destemail = your@email.here
sendername = Fail2Ban

[sshd]
enabled = true
port = 22

[sshd-ddos]
enabled = true
port = 22
</code></pre></div><p>最后重启fail2ban：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>systemctl restart fail2ban
</code></pre></div><h2 id=sshhttphttps>安装防火墙并只暴露SSH、HTTP、HTTPS端口</h2><p>首先，安装 iptables-persistent。在安装期间，它将询问你是否保留现有规则。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>apt install -y iptables-persistent
</code></pre></div><p>编辑 <code>/etc/iptables/rules.v4</code> 并添加如下内容：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>*filter

#  Allow all loopback (lo0) traffic and drop all traffic to 127/8 that doesn&#39;t use lo0
-A INPUT -i lo -j ACCEPT
-A INPUT ! -i lo -d 127.0.0.0/8 -j REJECT

#  Accept all established inbound connections
-A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT

#  Allow all outbound traffic - you can modify this to only allow certain traffic
-A OUTPUT -j ACCEPT

#  Allow HTTP and HTTPS connections from anywhere (the normal ports for websites and SSL).
-A INPUT -p tcp --dport 80 -j ACCEPT
-A INPUT -p tcp --dport 443 -j ACCEPT

#  Allow SSH connections
#  The -dport number should be the same port number you set in sshd_config
-A INPUT -p tcp -m state --state NEW --dport 22 -j ACCEPT

#  Allow ping
-A INPUT -p icmp -m icmp --icmp-type 8 -j ACCEPT

#  Log iptables denied calls
-A INPUT -m limit --limit 5/min -j LOG --log-prefix &#34;iptables denied: &#34; --log-level 7

#  Reject all other inbound - default deny unless explicitly allowed policy
-A INPUT -j REJECT
-A FORWARD -j REJECT

COMMIT
</code></pre></div><p>iptables-persistent 将在机器启动时自动加载配置。但是由于我们现在不会立刻重启，我们需要第一次手动加载它：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>iptables-restore &lt; /etc/iptables/rules.v4
</code></pre></div><figure><p><strong>翻译状态：</strong>
本文是英文页面 <a href=/en/admin/prerequisites/>Preparing your machine</a> 的翻译，最后翻译时间：2020-05-04，点击<a href=https://github.com/chasedream1129/mastodon-docs/compare/ad1ef20f171c9f61439f32168987b0b4f9abd74b...master>这里</a>可以查看翻译后页面的改动。</p></figure><p style=color:#687590>最后更新于 October 7, 2020 · <a href=https://github.com/chasedream1129/mastodon-docs/tree/master/content/zh-cn/admin/prerequisites.md style=color:#687590>改进此页面</a><br>也可在此找到：
<a href=https://docs.monado.ren/en/admin/prerequisites/ style=color:#687590 hreflang=en>English</a></p></div></main></div></body></html>