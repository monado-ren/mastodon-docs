<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" type=image/png href=/favicon.ico><link rel=stylesheet href=https://docs.monado.ren/style.min.ac66b095598a93816a47e5ef5b071058047fa4bd8770cb4515ca10c1ad6f91c0.css><script src=https://docs.monado.ren/main.min.db37c27117ff8400e5e30549f6806d2bc825668b596d81316c6148417f59bc72.js async></script><title>升级到新版本 - Mastodon文档 -Monado-</title><meta property="og:type" content="article"><meta property="og:url" content="https://docs.monado.ren/admin/upgrading/"><meta name=twitter:title content="升级到新版本"><meta name=twitter:site content="@joinmastodon"><link rel=canonical href=https://docs.monado.ren/admin/upgrading/></head><body><div class="container sidebar-layout"><nav class=sidebar><a class=brand href=/><img class=link-logo src=/brand.svg alt=Mastodon></a><ul><li><a href=/>什么是Mastodon？</a></li><li><span class=sub-title>使用Mastodon</span><ul class=sub-menu><li><a href=/user/signup/>创建一个帐户</a></li><li><a href=/user/profile/>设置个人资料</a></li><li><a href=/user/posting/>发布嘟文</a></li><li><a href=/user/network/>使用社交功能</a></li><li><a href=/user/moderating/>处理不想要的内容</a></li><li><a href=/user/discoverability/>推广自己和他人</a></li><li><a href=/user/preferences/>设置你的首选项</a></li><li><a href=/user/contacts/>更多设置</a></li><li><a href=/user/external/>站外使用Mastodon</a></li><li><a href=/user/pwa/>使用PWA版Mastodon</a></li><li><a href=/user/moving/>迁移或删除帐户</a></li><li><a href=/user/run-your-own/>运行自己的服务器</a></li></ul></li><li><span class=sub-title>运营Mastodon</span><ul class=sub-menu><li><a href=/admin/prerequisites/>准备你的机器</a></li><li><a href=/admin/install/>从源中安装</a></li><li><a href=/admin/config/>设置你的环境</a></li><li><a href=/admin/optional/>安装可选特色功能</a><ul class=sub-menu><li><a href=/admin/optional/elasticsearch/>全文搜索</a></li><li><a href=/admin/optional/tor/>匿名服务</a></li><li><a href=/admin/optional/sso/>单点登录（SSO）</a></li></ul></li><li><a href=/admin/setup/>配置你的新实例</a></li><li><a href=/admin/tootctl/>使用管理命令行</a></li><li><a href=/admin/upgrading/ class=active>升级到新版本</a></li><li><a href=/admin/backups/>备份你的服务器</a></li><li><a href=/admin/migrating/>迁移到新机器</a></li><li><a href=/admin/scaling/>伸缩你的服务器</a></li><li><a href=/admin/moderation/>运营操作</a></li><li><a href=/admin/troubleshooting/>故障分析</a></li></ul></li><li><span class=sub-title>前往英文版查看更多</span><ul class=sub-menu><li><a href=/more/more/>更多</a></li></ul></li></ul></nav><main><h1>升级到新版本</h1><aside><nav id=TableOfContents></nav></aside><div class=e-content><div class="hint hint-info"><div class=hint-icon><i class="fa fa-info-circle"></i></div>当一个新的Mastodon版本释出后，它将出现在<a href=https://github.com/tootsuite/mastodon/releases>GitHub releases页面</a>。请注意：运行来自<code>master</code>分支的未释出代码，虽然可以进行，但不推荐这样做。</div><p>Mastodon版本与git tags一致。在尝试升级之前，请至<a href=https://github.com/tootsuite/mastodon/releases>GitHub releases页面</a>查找所需版本。该页面包含了一个<strong>更新日专</strong>，其中描述你需要了解的所有差异，以及<strong>特定的升级指令</strong>。</p><p>开始之前，切换至<code>mastodon</code>用户：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>su - mastodon
</code></pre></div><p>并转至Mastodon根目录：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#8be9fd;font-style:italic>cd</span> /home/mastodon/live
</code></pre></div><p>下载相应版本代码，这里假定版本为<code>v3.1.2</code>：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>git fetch --tags
git checkout v3.1.2
</code></pre></div><p>现在，执行GitHub版本发布说明中的升级指令。因为不同的版本有不同的指令，所以本页面将不包括任何指令。</p><div class="hint hint-info"><div class=hint-icon><i class="fa fa-info-circle"></i></div>从旧版本升级时，你可以安全的跳过中间版本。你无需单独检出他们。然而，你确实需要追踪每一个版本的升级指令。大多数指令都是重叠的，你只需要确保每条至少执行一次即可。</div><p>当你执行完版本发布说明中的指令后，切换回root用户：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#8be9fd;font-style:italic>exit</span>
</code></pre></div><p>重启<strong>后台worker</strong>：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>systemctl restart mastodon-sidekiq
</code></pre></div><p>并重载<strong>web进程</strong>：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>systemctl reload mastodon-web
</code></pre></div><div class="hint hint-info"><div class=hint-icon><i class="fa fa-info-circle"></i></div><code>reload</code>操作是零下线时间的重启（restart），也被称为“分阶段重启（phased restart）”。因此，Mastodon升级通常不需要为计划下线而提前发布公告。罕见情况下，你可以改用<code>restart</code>操作，但你的用户将感到（短暂的）服务中断。</div><p>罕见情况下，<strong>streaming API</strong> 服务也会被更新并需要重启：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>systemctl restart mastodon-streaming
</code></pre></div><div class="hint hint-danger"><div class=hint-icon><i class="fa fa-exclamation-triangle"></i></div>更新streaming API服务非常罕见，在大多数版本中，<em>不</em>需要重启它。重启streaming API将导致服务器负载增加，因为断线的用户会尝试重连或改用REST API轮询。因此请尽量避免重启streaming API服务</div><div class="hint hint-success"><div class=hint-icon><i class="fa fa-check-circle"></i></div><strong>就这样！</strong> 您现在正在运行新版本的Mastodon。</div><figure><p><strong>翻译状态：</strong>
本文是英文页面 <a href=/en/admin/upgrading/>Upgrading to a new release</a> 的翻译，最后翻译时间：2020-05-04，点击<a href=https://github.com/chasedream1129/mastodon-docs/compare/ad1ef20f171c9f61439f32168987b0b4f9abd74b...master>这里</a>可以查看翻译后页面的改动。</p></figure><p style=color:#687590>最后更新于 October 7, 2020 · <a href=https://github.com/chasedream1129/mastodon-docs/tree/master/content/zh-cn/admin/upgrading.md style=color:#687590>改进此页面</a><br>也可在此找到：
<a href=https://docs.monado.ren/en/admin/upgrading/ style=color:#687590 hreflang=en>English</a></p></div></main></div></body></html>