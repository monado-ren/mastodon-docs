<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" type=image/png href=/favicon.ico><link rel=stylesheet href=https://docs.monado.ren/style.min.ac66b095598a93816a47e5ef5b071058047fa4bd8770cb4515ca10c1ad6f91c0.css><script src=https://docs.monado.ren/main.min.db37c27117ff8400e5e30549f6806d2bc825668b596d81316c6148417f59bc72.js async></script><title>故障分析 - Mastodon文档 -Monado-</title><meta property="og:type" content="article"><meta property="og:url" content="https://docs.monado.ren/admin/troubleshooting/"><meta name=twitter:title content="故障分析"><meta name=twitter:site content="@joinmastodon"><link rel=canonical href=https://docs.monado.ren/admin/troubleshooting/></head><body><div class="container sidebar-layout"><nav class=sidebar><a class=brand href=/><img class=link-logo src=/brand.svg alt=Mastodon></a><ul><li><a href=/>什么是Mastodon？</a></li><li><span class=sub-title>使用Mastodon</span><ul class=sub-menu><li><a href=/user/signup/>创建一个帐户</a></li><li><a href=/user/profile/>设置个人资料</a></li><li><a href=/user/posting/>发布嘟文</a></li><li><a href=/user/network/>使用社交功能</a></li><li><a href=/user/moderating/>处理不想要的内容</a></li><li><a href=/user/discoverability/>推广自己和他人</a></li><li><a href=/user/preferences/>设置你的首选项</a></li><li><a href=/user/contacts/>更多设置</a></li><li><a href=/user/external/>站外使用Mastodon</a></li><li><a href=/user/pwa/>使用PWA版Mastodon</a></li><li><a href=/user/moving/>迁移或删除帐户</a></li><li><a href=/user/run-your-own/>运行自己的服务器</a></li></ul></li><li><span class=sub-title>运营Mastodon</span><ul class=sub-menu><li><a href=/admin/prerequisites/>准备你的机器</a></li><li><a href=/admin/install/>从源中安装</a></li><li><a href=/admin/config/>设置你的环境</a></li><li><a href=/admin/optional/>安装可选特色功能</a><ul class=sub-menu><li><a href=/admin/optional/elasticsearch/>全文搜索</a></li><li><a href=/admin/optional/tor/>匿名服务</a></li><li><a href=/admin/optional/sso/>单点登录（SSO）</a></li></ul></li><li><a href=/admin/setup/>配置你的新实例</a></li><li><a href=/admin/tootctl/>使用管理命令行</a></li><li><a href=/admin/upgrading/>升级到新版本</a></li><li><a href=/admin/backups/>备份你的服务器</a></li><li><a href=/admin/migrating/>迁移到新机器</a></li><li><a href=/admin/scaling/>伸缩你的服务器</a></li><li><a href=/admin/moderation/>运营操作</a></li><li><a href=/admin/troubleshooting/ class=active>故障分析</a></li></ul></li><li><span class=sub-title>前往英文版查看更多</span><ul class=sub-menu><li><a href=/more/more/>更多</a></li></ul></li></ul></nav><main><h1>故障分析</h1><aside><nav id=TableOfContents><ul><li><ul><li><a href=#heading>我看到一个故障页说一些东西出错了。我怎么找出哪里出错了？</a></li><li><a href=#heading-1>升级新版本后，有些页面看起来很奇怪，就像它们含有未设置样式的元素一样。为什么？</a></li><li><a href=#-missing-columns-or-tables>升级新版本后，一些请求失败了，日志中的错误信息是 missing columns or tables。为什么？</a></li><li><a href=#-tootctl--rakerails--uninitialized-constants->我试图运行 tootctl 或 rake/rails 命令，但我得到 uninitialized constants 错误信息。哪里出错了？</a></li></ul></li></ul></nav></aside><div class=e-content><h2 id=heading><strong>我看到一个故障页说一些东西出错了。我怎么找出哪里出错了？</strong></h2><p>所有带堆栈追踪（stack traces）的错误信息都将会被写入系统日志。当使用systemd时，可使用 <code>journalctl -u mastodon-web</code>（替换以相应的服务名） 来浏览每个服务的日志。当使用Docker时，与之类似：<code>docker logs mastodon_web_1</code>（替换以相应的容器名）。</p><p>服务端详细错误信息将<em>永不会</em>公开显示，因为它们可能会暴露你的内部设置，并为攻击者提供线索，让他们了解如何更好的入侵或如何更高效的滥用。</p><p>来自Mastodon web服务器的每一个响应都带有独一无二的请求ID（request ID），该ID也将反映在日志中。通过检查错误页的请求头，你可以在日志中轻松找到与之对应的堆栈追踪（stack traces）。</p><h2 id=heading-1><strong>升级新版本后，有些页面看起来很奇怪，就像它们含有未设置样式的元素一样。为什么？</strong></h2><p>检查升级后，你是否运行 <code>RAILS_ENV=production bin/rails assets:precompile</code> 并重启Mastodon web 进程。因为这看起来像提供了过期的样式与脚本。这也有可能由于内存缺乏导致预编译失败，很不幸webpack会占用大量内存。如果是这个原因，请确保你已经分配了swap空间。另外，也可以在另一台机器上预编译静态文件，然后把它们复制至 <code>public/packs</code> 目录。</p><h2 id=-missing-columns-or-tables><strong>升级新版本后，一些请求失败了，日志中的错误信息是 missing columns or tables。为什么？</strong></h2><p>检查升级后，你是否运行 <code>RAILS_ENV=production bin/rails db:migrate</code>。因为这看起来Mastodon代码访问了一个更新或更旧的数据库schema。如果你使用PgBouncer，请确保此命令直接连接PostgreSQL，因为PgBouncer不支持迁移过程中的锁表操作。</p><h2 id=-tootctl--rakerails--uninitialized-constants-><strong>我试图运行 <code>tootctl</code> 或 <code>rake</code>/<code>rails</code> 命令，但我得到 uninitialized constants 错误信息。哪里出错了？</strong></h2><p>检查你是否在命令前使用 <code>RAILS_ENV=production</code> 指定正确的环境。默认情况下，假定使用开发环境，因此代码尝试加载开发相关gem。然而，在生产环境中，我们避免安装这些gem。这就是错误的来源。</p><figure><p><strong>翻译状态：</strong>
本文是英文页面 <a href=/en/admin/troubleshooting/>Troubleshooting errors</a> 的翻译，最后翻译时间：2020-05-08，点击<a href=https://github.com/chasedream1129/mastodon-docs/compare/ad1ef20f171c9f61439f32168987b0b4f9abd74b...master>这里</a>可以查看翻译后页面的改动。</p></figure><p style=color:#687590>最后更新于 October 7, 2020 · <a href=https://github.com/chasedream1129/mastodon-docs/tree/master/content/zh-cn/admin/troubleshooting.md style=color:#687590>改进此页面</a><br>也可在此找到：
<a href=https://docs.monado.ren/en/admin/troubleshooting/ style=color:#687590 hreflang=en>English</a></p></div></main></div></body></html>