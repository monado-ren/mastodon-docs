<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" type=image/png href=/favicon.ico><link rel=stylesheet href=https://docs.monado.ren/style.min.ac66b095598a93816a47e5ef5b071058047fa4bd8770cb4515ca10c1ad6f91c0.css><script src=https://docs.monado.ren/main.min.db37c27117ff8400e5e30549f6806d2bc825668b596d81316c6148417f59bc72.js async></script><title>备份你的服务器 - Mastodon文档 -Monado-</title><meta property="og:type" content="article"><meta property="og:url" content="https://docs.monado.ren/admin/backups/"><meta name=description content="设置日常备份（可选，但并非如此）"><meta property="og:description" content="设置日常备份（可选，但并非如此）"><meta name=twitter:description content="设置日常备份（可选，但并非如此）"><meta name=twitter:title content="备份你的服务器"><meta name=twitter:site content="@joinmastodon"><link rel=canonical href=https://docs.monado.ren/admin/backups/></head><body><div class="container sidebar-layout"><nav class=sidebar><a class=brand href=/><img class=link-logo src=/brand.svg alt=Mastodon></a><ul><li><a href=/>什么是Mastodon？</a></li><li><span class=sub-title>使用Mastodon</span><ul class=sub-menu><li><a href=/user/signup/>创建一个帐户</a></li><li><a href=/user/profile/>设置个人资料</a></li><li><a href=/user/posting/>发布嘟文</a></li><li><a href=/user/network/>使用社交功能</a></li><li><a href=/user/moderating/>处理不想要的内容</a></li><li><a href=/user/discoverability/>推广自己和他人</a></li><li><a href=/user/preferences/>设置你的首选项</a></li><li><a href=/user/contacts/>更多设置</a></li><li><a href=/user/external/>站外使用Mastodon</a></li><li><a href=/user/pwa/>使用PWA版Mastodon</a></li><li><a href=/user/moving/>迁移或删除帐户</a></li><li><a href=/user/run-your-own/>运行自己的服务器</a></li></ul></li><li><span class=sub-title>运营Mastodon</span><ul class=sub-menu><li><a href=/admin/prerequisites/>准备你的机器</a></li><li><a href=/admin/install/>从源中安装</a></li><li><a href=/admin/config/>设置你的环境</a></li><li><a href=/admin/optional/>安装可选特色功能</a><ul class=sub-menu><li><a href=/admin/optional/elasticsearch/>全文搜索</a></li><li><a href=/admin/optional/tor/>匿名服务</a></li><li><a href=/admin/optional/sso/>单点登录（SSO）</a></li></ul></li><li><a href=/admin/setup/>配置你的新实例</a></li><li><a href=/admin/tootctl/>使用管理命令行</a></li><li><a href=/admin/upgrading/>升级到新版本</a></li><li><a href=/admin/backups/ class=active>备份你的服务器</a></li><li><a href=/admin/migrating/>迁移到新机器</a></li><li><a href=/admin/scaling/>伸缩你的服务器</a></li><li><a href=/admin/moderation/>运营操作</a></li><li><a href=/admin/troubleshooting/>故障分析</a></li></ul></li><li><span class=sub-title>前往英文版查看更多</span><ul class=sub-menu><li><a href=/more/more/>更多</a></li></ul></li></ul></nav><main><h1>备份你的服务器</h1><p>设置日常备份（可选，但并非如此）</p><aside><nav id=TableOfContents><ul><li><ul><li><a href=#overview>概览</a></li><li><a href=#failure>故障模式</a></li><li><a href=#env>备份应用密钥</a></li><li><a href=#postgresql>备份 PostgreSQL</a></li><li><a href=#media>备份用户上传的文件</a></li><li><a href=#redis>备份 Redis</a></li></ul></li></ul></nav></aside><div class=e-content><p>对于任何真实世界用途来说，你都应该保证日常备份Mastodon服务器。</p><h2 id=overview>概览</h2><p>你所需要备份的东西，按重要程度排序：</p><ol><li>PostgreSQL 数据库</li><li><code>.env.production</code> 文件或等效文件中的应用密钥</li><li>用户上传的文件</li><li>Redis 数据库</li></ol><h2 id=failure>故障模式</h2><p>人们通常要应对两种类型故障：硬件故障，诸如磁盘上数据损坏；以及人为软件故障，诸如误删特定文件。本文档中，仅考虑前一种类型。</p><p>丢失PostgreSQL数据库，那一切都完了。Mastodon将所有重要数据存储于PostgreSQL数据库中。如果数据库消失，那你服务器上所有的帐户、所有的嘟文、所有关注者都将随之消失。</p><p>如果你丢失了应用密钥，对你的用户而言，Mastodon的某些功能将停止工作。你服务器上的用户将被登出，双因子认证（2FA）将不可用，Web Push API订阅将停止工作。</p><p>如果你丢失了用户上传的文件，你将丢失头像、横幅、媒体附件，但Mastodon<em>仍会</em>继续工作。</p><p>丢失Redis数据库几乎是无害的：唯一不可逆的数据是Sidekiq队列及之前失败任务的重试计划。主页与列表时间流虽然存储于Redis，但它们可以使用tootctl再生成。</p><p>最好的备份是所谓的异地备份，即与Mastodon自身不在同一台计算机上存储的备份。如果你托管的服务器起火了，硬盘爆炸了，存储于同一硬件备份将不可用。</p><h2 id=env>备份应用密钥</h2><p>应用密钥是最容易备份的，因为它们是不变的。你只需要将 <code>.env.production</code> 存储在安全的地方就可以了。</p><h2 id=postgresql>备份 PostgreSQL</h2><p>突然断电、硬盘故障、错误迁移数库库schema都会致使数据损坏。由于以上原因，推荐偶尔使用 <code>pg_dump</code> 或 <code>pg_dumpall</code> 备份数据库。</p><p>如果要求高可用性，可以使用热流拷贝（hot streaming replication）使第二台PostgreSQL服务器始终具有最新数据，并做好另一台服务器出现故障切换至此的准备。</p><h2 id=media>备份用户上传的文件</h2><p>如果你使用外部对象存储，诸如Amazon S3、Google Cloud 或 Wasabi，你无需为怎么备份它们而担心。各自的公司将负责处理硬件故障。</p><p>如果你使用本地文件存储，复制体积巨大的 <code>public/system</code> 目录（默认存储上传文件的地方）。</p><h2 id=redis>备份 Redis</h2><p>备份Redis是很容易的。Redis会定期将数据写入<code>/var/lib/redis/dump.rdb</code>文件，你只需要复制这个文件就可以了。</p><figure><p><strong>翻译状态：</strong>
本文是英文页面 <a href=/en/admin/backups/>Backing up your server</a> 的翻译，最后翻译时间：2020-05-06，点击<a href=https://github.com/chasedream1129/mastodon-docs/compare/ad1ef20f171c9f61439f32168987b0b4f9abd74b...master>这里</a>可以查看翻译后页面的改动。</p></figure><p style=color:#687590>最后更新于 October 7, 2020 · <a href=https://github.com/chasedream1129/mastodon-docs/tree/master/content/zh-cn/admin/backups.md style=color:#687590>改进此页面</a><br>也可在此找到：
<a href=https://docs.monado.ren/en/admin/backups/ style=color:#687590 hreflang=en>English</a></p></div></main></div></body></html>